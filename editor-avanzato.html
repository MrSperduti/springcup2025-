
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Editor Avanzato Completo</title>
  <link rel="stylesheet" href="style.css">
  <style>
    textarea { width: 100%; min-height: 40px; margin-top: 5px; }
    .section { margin-top: 40px; }
    .item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fff; }
    .item h4 { margin-top: 0; }
    .actions button { margin-right: 10px; }
    pre.json-preview { background: #eee; padding: 10px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="text-align:center">Editor Avanzato SPRING CUP 2025</h2>

    <div class="section">
      <h3>ðŸ“‚ Carica file dati.json</h3>
      <input type="file" id="fileInput">
    </div>

    <div class="section">
      <h3>ðŸ“‹ Seleziona Categoria</h3>
      <select id="selectCategoria"></select>
    </div>

    <div class="section">
      <h3>ðŸ“„ Anteprima dati correnti</h3>
      <pre class="json-preview" id="previewDati"></pre>
    </div>

    <!-- Le altre sezioni verranno aggiunte nello script JS -->

    <div class="section">
      <button onclick="esporta()">ðŸ’¾ Esporta dati.json</button>
    </div>
  </div>

  <script>
    let dati = {};
    let categoriaSelezionata = '';

    document.getElementById("fileInput").addEventListener("change", e => {
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          dati = JSON.parse(event.target.result);
          aggiornaCategorie();
          aggiornaPreview();
          alert("File caricato con successo!");
        } catch (err) {
          alert("Errore nel caricamento del file. VerrÃ  mostrata la struttura vuota.");
          dati = {
            "Under 17": { "partite": [], "gironi": {}, "finali": [] },
            "Under 15": { "partite": [], "gironi": {}, "finali": [] },
            "Under 13": { "partite": [], "gironi": {}, "finali": [] },
            "2014/15": { "partite": [], "gironi": {}, "finali": [] },
            "2016/17": { "partite": [], "gironi": {}, "finali": [] },
            "Under 15 femminile": { "partite": [], "gironi": {}, "finali": [] },
            "Under 13 femminile": { "partite": [], "gironi": {}, "finali": [] }
          };
          aggiornaCategorie();
          aggiornaPreview();
        }
      };
      reader.readAsText(e.target.files[0]);
    });

    function aggiornaCategorie() {
      const select = document.getElementById("selectCategoria");
      select.innerHTML = "";
      Object.keys(dati).forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        select.appendChild(opt);
      });
      if (select.options.length > 0) {
        select.selectedIndex = 0;
        categoriaSelezionata = select.value;
      }
      select.onchange = () => {
        categoriaSelezionata = select.value;
        aggiornaPreview();
      };
    }

    function aggiornaPreview() {
      document.getElementById("previewDati").textContent = JSON.stringify(dati[categoriaSelezionata], null, 2);
    }

    function esporta() {
      const blob = new Blob([JSON.stringify(dati, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "dati.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
  <script src="editor-avanzato.js"></script>
</body>
</html>
